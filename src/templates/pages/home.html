{% extends 'layout2.html' %}
{% block title %} Home {% endblock title %}
{% block customCSS %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
{% endblock customCSS %}
{% block content %}
{% if is_admin %}
<div class="new-btn">
  <a href="/register" class="btn btn-success">New User</a>
</div>
{% endif %}
<table class="table table-hover">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Full Name</th>
        <th scope="col">User Name</th>
        <th scope="col">Email</th>
        <th scope="col">Role</th>
        <th scope="col">Actions</th>            
      </tr>
    </thead>
    <tbody>
        {% for user in users %}
        <tr>
          <th scope="row">{{user.id}}</th>
          <td>{{user.full_name}}</td>
          <td>{{user.user_name}}</td>
          <td>{{user.email}}</td>
          <td>{{user.role}}</td>
          <td>
            {% if user.id == logged_user_id or is_admin %}          
            <a href="/users/{{user.id}}/edit" class="btn btn-primary">Edit</a>
            {% endif %}
            {% if is_admin %}
            <a href="{{ url_for('main.delete_user', id=user.id )}}" class="btn btn-danger delete-btn">Delete</a>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
    </tbody>
  </table>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
  //We need to use AJAX to send a DELETE request to the server since forms only support GET and POST
$(document).ready(function() {
    $('.delete-btn').click(function(e) {
        e.preventDefault();
        $.ajax({
            url: $(this).attr('href'),
            type: 'DELETE',
            success: function(result) {
              console.log("DELETE request was successful");
              if(result.success){
                location.reload();
              }
            }
        });
    });
});
</script>
{% endblock content %}
